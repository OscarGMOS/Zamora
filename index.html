
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Zamora vaciada</title>
  <meta name="description" content="Prototipo en HTML/CSS/JS con scrollytelling, term√≥metro de despoblaci√≥n embebido desde Flourish y mapa animado con Mapbox." />

  <!-- Mapbox GL JS -->
  <link href="mapbox-gl.css" rel="stylesheet" />
  <script src="mapbox-gl.js"></script>
  
  <!-- Mapbox GL JS Plugins para controles adicionales -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mapbox/mapbox-gl-geocoder@4.7.0/dist/mapbox-gl-geocoder.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/@mapbox/mapbox-gl-geocoder@4.7.0/dist/mapbox-gl-geocoder.min.js"></script>

  <!-- Scrollama para scrollytelling -->
  <script src="https://unpkg.com/scrollama"></script>

  <!-- GSAP para animaciones suaves -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <a class="skip-link" href="#story">Saltar al contenido principal</a>
  <header class="hero" role="banner">
    <div class="hero__inner">
      <h1>Zamora en riesgo: ¬øPodemos revertir la despoblaci√≥n?</h1>
      <p class="lead">Narrativa interactiva sobre c√≥mo afecta la despoblaci√≥n a Zamora.</p>
      <a class="btn btn--primary" href="#story">Comenzar</a>
    </div>
  </header>

  <!-- Contenedor principal del scrollytelling -->
  <main id="story" class="scrolly" role="main" aria-label="Narrativa interactiva">
    <!-- Panel fijo (sticky) a la derecha: mapa de referencia est√°tico -->
    <aside class="figure" aria-label="Mapa de referencia">
      <div class="map-reference" role="group" aria-labelledby="map-reference-title" aria-describedby="map-reference-subtitle map-reference-hint">
        <h3 id="map-reference-title">P√©rdida poblacional 1960‚Äì2020</h3>
        <p id="map-reference-subtitle" class="map-reference__subtitle">Municipios con datos disponibles</p>
        <p id="map-reference-hint" class="map-reference__hint">Pasa el cursor para ver detalles</p>
        <div id="map-reference-container" class="map-reference__container" role="img" aria-label="Mapa de Zamora con p√©rdida poblacional por municipio"></div>
        <div class="map-reference__legend">
          <div class="legend-item">
            <div class="legend-dot" style="background: #2a9d8f;"></div>
            <span>Estable / Crecimiento</span>
          </div>
          <div class="legend-item">
            <div class="legend-dot" style="background: #d4a574;"></div>
            <span>P√©rdida moderada</span>
          </div>
          <div class="legend-item">
            <div class="legend-dot" style="background: #e76f51;"></div>
            <span>Zona cr√≠tica</span>
          </div>
        </div>
      </div>
    </aside>

    <!-- Columna de texto con pasos -->
    <section class="article">
      <div class="step" data-step="intro" data-center="-6.36,41.64" data-zoom="7.4" role="region" aria-labelledby="step-intro-title">
        <h2 id="step-intro-title">Un territorio que se apaga</h2>
        <p>En gran parte de Espa√±a, el silencio ha ido ganando terreno. Donde antes hab√≠a escuelas llenas, bares ruidosos y plazas con vida, hoy quedan ventanas cerradas y calles que se vac√≠an al caer la tarde.</p>
<p>Zamora es uno de esos lugares donde el tiempo parece avanzar m√°s r√°pido que la gente. Cada a√±o pierde habitantes, servicios y oportunidades. No es un fen√≥meno nuevo, pero s√≠ uno que empieza a marcar el futuro de toda una provincia.</p>
<p>En esta historia te propongo recorrer ese camino: entender c√≥mo hemos llegado hasta aqu√≠, qu√© est√° pasando ahora y, sobre todo, qu√© podr√≠a pasar si decidimos actuar‚Ä¶ o si no hacemos algo.</p>     
<p class="hint">Despl√°zate para activar el mapa ‚Üí</p>
        <img src="zamora.jpg" alt="Zamora paisaje" />
      </div>

      <div class="step" data-step="thermo" data-center="-6.20,41.29" data-zoom="7.3" role="region" aria-labelledby="step-thermo-title">
        <h2 id="step-thermo-title">Midiendo el pulso de la despoblaci√≥n</h2>
        <p>Para entender la despoblaci√≥n no basta con mirar cu√°nta gente vive en un sitio. Hay se√±ales que cuentan mucho m√°s.</p>
        <p>La densidad, por ejemplo, nos dice si un territorio est√° lleno de vida o si empieza a quedarse hueco. El envejecimiento muestra si hay relevo generacional o si la poblaci√≥n se apoya cada vez m√°s en personas mayores. Y la migraci√≥n revela si la gente llega‚Ä¶ o si se marcha.</p>
        <p>Este indicador re√∫ne esas se√±ales en un solo vistazo. No es un n√∫mero fr√≠o: es una forma de medir el pulso de la provincia. Y como ver√°s, en muchos municipios ese pulso late cada vez m√°s despacio.</p>
        <img src="Escuela abandonada.jpg"  alt="Escuela abandonada" /> 
        <!-- Term√≥metro embebido con Flourish -->
        <div id="thermo" style="width: 100%; height: 600px; margin-top: 1.5rem;" role="img" aria-label="Term√≥metro de despoblaci√≥n">
          <div class="flourish-embed" data-src="story/3566718" style="width: 100%; height: 100%;"><script src="https://public.flourish.studio/resources/embed.js"></script><noscript><img src="https://public.flourish.studio/story/3566718/thumbnail" width="100%" alt="Term√≥metro de despoblaci√≥n" /></noscript></div>
        </div>
      </div>

      <div class="step" data-step="timeline" data-center="-6.73,42.04" data-zoom="7.2" role="region" aria-labelledby="step-timeline-title">
  <h2 id="step-timeline-title">As√≠ hemos llegado hasta aqu√≠</h2>
  <p>
    Si miramos atr√°s, la historia de Zamora es la historia de muchas zonas rurales de Espa√±a.
  </p>
  <p>
    En los a√±os 60, los pueblos estaban llenos de vida. La agricultura y la ganader√≠a sosten√≠an a miles de familias, 
    y la mayor√≠a de la poblaci√≥n viv√≠a en el territorio. Pero poco a poco, el trabajo se concentr√≥ en las ciudades, 
    y con √©l se fueron los j√≥venes.
  </p>
  <p>
    Como si el territorio perdiera brillo, los puntos se van desaturando y bajando en el gr√°fico a medida que su poblaci√≥n cae con el paso del tiempo. Menos nacimientos, m√°s envejecimiento, m√°s casas vac√≠as.
  </p>
  <p>
    Este recorrido animado muestra esa transformaci√≥n. No es solo una l√≠nea que baja: es la historia de c√≥mo un 
    territorio cambi√≥ en apenas dos generaciones.
  </p>
  

  <!-- Aqu√≠ insertamos tu scatter animado -->
  <div class="flourish-embed flourish-scatter" role="img" aria-label="Evoluci√≥n de poblaci√≥n de municipios de Zamora en el tiempo"
       data-src="visualisation/27362978"
       style="width:100%; height: 500px; margin-top:0.3rem;">
    <script src="https://public.flourish.studio/resources/embed.js"></script>
    <noscript>
      <img src="https://public.flourish.studio/visualisation/27362978/thumbnail" 
           width="100%" 
           alt="scatter visualization" />
    </noscript>
  </div>
  <div class="video-wrapper" style="width:100%; margin-top: 1.5rem; margin-bottom: 0;">
    <iframe src="https://secure-embed.rtve.es/drmn/embed/video/5944585" 
            title="Combatir el √©xodo rural y defender la vida de pueblo en Espa√±a" 
            style="width:100%; height:500px; border:none;" 
            allowfullscreen="allowfullscreen"
            aria-label="V√≠deo sobre el √©xodo rural">
    </iframe>
  </div>
</div>


      <div class="step" data-step="scenarios" data-center="-5.67,42.00" data-zoom="7.2" role="region" aria-labelledby="step-scenarios-title">
        <h2 id="step-scenarios-title">¬øY ahora qu√©?</h2>
        <p>El futuro no est√° escrito. Y eso es una buena noticia.</p>
<p>En 2040, Zamora podr√≠a seguir perdiendo poblaci√≥n‚Ä¶ o podr√≠a empezar a recuperarla. Todo depende de las decisiones que tomemos hoy.</p>
<p>Aqu√≠ puedes explorar tres caminos posibles:
  <ul>
    <li><strong>Sin intervenci√≥n:</strong> la tendencia contin√∫a y muchos municipios seguir√°n vaci√°ndose.</li>
    <li><strong>Escenario moderado:</strong> se aplican pol√≠ticas de apoyo, mejora de servicios y conectividad. La ca√≠da se frena.</li>
    <li><strong>Escenario agresivo:</strong> se apuesta fuerte por la repoblaci√≥n, la digitalizaci√≥n y la econom√≠a rural. Algunos municipios vuelven a crecer.</li>
  </ul>
<p>No son predicciones exactas, sino una forma de imaginar qu√© podr√≠a pasar si cambiamos ‚Äîo no cambiamos‚Äî el rumbo.</p>
        <div class="controls" role="group" aria-label="Selecciona un escenario">
          <button class="btn active" type="button" data-scenario="base" aria-pressed="true" aria-controls="scenario-base">Sin intervenci√≥n</button>
          <button class="btn" type="button" data-scenario="moderado" aria-pressed="false" aria-controls="scenario-moderado">Pol√≠ticas moderadas</button>
          <button class="btn" type="button" data-scenario="agresivo" aria-pressed="false" aria-controls="scenario-agresivo">Pol√≠ticas agresivas</button>
        </div>
        <div id="scenarios" style="width: 100%; height: 600px; margin-top: 1.5rem; position: relative;" role="region" aria-label="Escenarios de futuro">
          <!-- Escenario 1: Sin intervenci√≥n -->
          <div class="scenario-embed active" id="scenario-base" style="width: 100%; height: 100%; position: absolute; top: 0; left: 0;" role="img" aria-label="Escenario sin intervenci√≥n" aria-hidden="false">
            <div class="flourish-embed" data-src="visualisation/27366398" style="width: 100%; height: 100%;"></div>
          </div>
          
          <!-- Escenario 2: Pol√≠ticas moderadas -->
          <div class="scenario-embed" id="scenario-moderado" style="width: 100%; height: 100%; position: absolute; top: 0; left: 0; display: none;" role="img" aria-label="Escenario con pol√≠ticas moderadas" aria-hidden="true">
            <div class="flourish-embed" data-src="visualisation/27366327" style="width: 100%; height: 100%;"></div>
          </div>
          
          <!-- Escenario 3: Pol√≠ticas agresivas -->
          <div class="scenario-embed" id="scenario-agresivo" style="width: 100%; height: 100%; position: absolute; top: 0; left: 0; display: none;" role="img" aria-label="Escenario con pol√≠ticas agresivas" aria-hidden="true">
            <div class="flourish-embed" data-src="visualisation/27366282" style="width: 100%; height: 100%;"></div>
          </div>
        </div>
        
      </div>

      <div class="step" data-step="cta" data-center="-5.90,41.63" data-zoom="7.4" role="region" aria-labelledby="step-cta-title">
        <h2 id="step-cta-title">El futuro est√° en nuestras manos.</h2>
        <p> La despoblaci√≥n no es un destino inevitable. Es una tendencia que podemos cambiar si entendemos sus causas y actuamos con decisi√≥n. </p> 
        <p> Cada pol√≠tica, cada inversi√≥n y cada proyecto puede marcar la diferencia entre un territorio que se apaga y otro que vuelve a encenderse. </p> 
        <p> T√∫ tambi√©n puedes opinar. ¬øQu√© camino crees que funcionar√≠a mejor? </p>
        <img src="mercado.jpg" alt="Mercado" />
        <div class="poll" role="group" aria-label="Encuesta sobre escenarios">
          <button class="btn btn--ghost" type="button" data-vote="base" aria-pressed="false">Sin intervenci√≥n</button>
          <button class="btn btn--ghost" type="button" data-vote="moderado" aria-pressed="false">Moderadas</button>
          <button class="btn btn--ghost" type="button" data-vote="agresivo" aria-pressed="false">Agresivas</button>
          <details id="pollResults" class="poll__results">
            <summary>Ver resultados de la encuesta</summary>
            <div id="resultsContent" class="results-content" role="status" aria-live="polite" aria-atomic="true">
              <p>Cargando resultados...</p>
            </div>
          </details>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer" role="contentinfo">
    <p>Prototipo educativo ¬© 2025. 
    </p>
  <p>

    Datos procedentes del

    <a href="https://www.ine.es">Instituto Nacional de Estad√≠stica (INE)</a>

    y del

    <a href="https://www.ign.esInstituto"> Geogr√°fico Nacional (IGN)</a>.

    Reutilizaci√≥n bajo licencia

    <a href="https://creativecommons.org/licenses/by/4.0/CC">Creative Commons BY 4.0</a>.

    Fuente: INE y IGN.

  </p>

  <p>
    V√≠deo: <a href="https://www.rtve.es/rtve/20150608/aviso-legal/1168221.shtml">RTVE Play (aviso legal)</a>.
    Im√°genes: <a href="https://pixabay.com/service/license/">Pixabay (licencia)</a>.
  </p>

  </footer>

  <!-- Cargar Flourish una sola vez -->
  <script src="https://public.flourish.studio/resources/embed.js"></script>

  <script>
    // === CONFIGURACI√ìN DE MAPBOX ===
    // Sustituye con tu token para ver el mapa real.
    window.MAPBOX_TOKEN = "pk.eyJ1Ijoib2dtNyIsImEiOiJjbWllZGNla3MwMWEyM2ZxdjM4bzR3emYwIn0.OQV-uhj8T_QBDMGU76ZYjg"; // <-- pon tu token aqu√≠

    // === CONTROL DE BOTONES PARA EL STORY DE FLOURISH ===
    document.addEventListener('DOMContentLoaded', function() {
      const scenarioButtons = document.querySelectorAll('.controls .btn');
      const scenarioEmbeds = document.querySelectorAll('.scenario-embed');

      // Esperar un poco a que Flourish se haya inicializado
      setTimeout(function() {
        if (window.Flourish && window.Flourish.createEmbeds) {
          window.Flourish.createEmbeds();
        }
      }, 500);

      scenarioButtons.forEach(button => {
        button.addEventListener('click', function() {
          const scenario = this.getAttribute('data-scenario');
          
          // Ocultar todos los embeds
          scenarioEmbeds.forEach(embed => {
            embed.style.display = 'none';
            embed.classList.remove('active');
            embed.setAttribute('aria-hidden', 'true');
          });
          
          // Mostrar el embed seleccionado
          const selectedEmbed = document.getElementById(`scenario-${scenario}`);
          if (selectedEmbed) {
            selectedEmbed.style.display = 'block';
            selectedEmbed.classList.add('active');
            selectedEmbed.setAttribute('aria-hidden', 'false');
          }
          
          // Marcar el bot√≥n como activo
          scenarioButtons.forEach(btn => {
            btn.classList.remove('active');
            btn.setAttribute('aria-pressed', 'false');
          });
          this.classList.add('active');
          this.setAttribute('aria-pressed', 'true');
        });
      });

      // === SISTEMA DE VOTACI√ìN CON LOCALSTORAGE ===
      const pollButtons = document.querySelectorAll('.poll .btn[data-vote]');
      const pollResults = document.getElementById('pollResults');
      const resultsContent = document.getElementById('resultsContent');

      // Cargar resultados al inicio
      cargarResultados();

      pollButtons.forEach(button => {
        button.addEventListener('click', function() {
          const escenario = this.getAttribute('data-vote');
          
          // Obtener votos actuales de localStorage
          const votos = JSON.parse(localStorage.getItem('encuesta_votos') || '{"base": 0, "moderado": 0, "agresivo": 0}');
          
          // Incrementar el voto
          votos[escenario]++;
          
          // Guardar de nuevo en localStorage
          localStorage.setItem('encuesta_votos', JSON.stringify(votos));
          
          // Mostrar resultados actualizados
          mostrarResultados(votos);
          pollResults.open = true; // Abrir el details autom√°ticamente
          
          // Deshabilitar botones temporalmente
          pollButtons.forEach(btn => {
            btn.disabled = true;
            btn.setAttribute('aria-disabled', 'true');
            btn.setAttribute('aria-pressed', 'false');
          });
          this.setAttribute('aria-pressed', 'true');
          setTimeout(() => {
            pollButtons.forEach(btn => {
              btn.disabled = false;
              btn.setAttribute('aria-disabled', 'false');
            });
          }, 1000);
        });
      });

      function cargarResultados() {
        const votos = JSON.parse(localStorage.getItem('encuesta_votos') || '{"base": 0, "moderado": 0, "agresivo": 0}');
        mostrarResultados(votos);
      }

      function mostrarResultados(votos) {
        const total = votos.base + votos.moderado + votos.agresivo;
        
        let escenarioGanador = 'base';
        let votos_ganador = votos.base;
        
        if (votos.moderado > votos_ganador) {
          escenarioGanador = 'moderado';
          votos_ganador = votos.moderado;
        }
        
        if (votos.agresivo > votos_ganador) {
          escenarioGanador = 'agresivo';
          votos_ganador = votos.agresivo;
        }
        
        const escenarios = {
          base: {
            titulo: 'Sin intervenci√≥n',
            descripcion: 'La tendencia contin√∫a y muchos municipios seguir√°n vaci√°ndose.',
            color: '#2a9d8f'
          },
          moderado: {
            titulo: 'Escenario moderado',
            descripcion: 'Se aplican pol√≠ticas de apoyo, mejora de servicios y conectividad. La ca√≠da se frena.',
            color: '#e76f51'
          },
          agresivo: {
            titulo: 'Escenario agresivo',
            descripcion: 'Se apuesta fuerte por la repoblaci√≥n, la digitalizaci√≥n y la econom√≠a rural. Algunos municipios vuelven a crecer.',
            color: '#f4a261'
          }
        };
        
        const ganador = escenarios[escenarioGanador];
        
        const porcentajes = {
          base: total > 0 ? ((votos.base / total) * 100).toFixed(1) : 0,
          moderado: total > 0 ? ((votos.moderado / total) * 100).toFixed(1) : 0,
          agresivo: total > 0 ? ((votos.agresivo / total) * 100).toFixed(1) : 0
        };
        
        const html = `
          <div style="display: flex; flex-direction: column; gap: 1.2rem; margin-top: 1rem;">
            <div style="padding: 1.2rem; background: rgba(${ganador.color === '#2a9d8f' ? '42, 157, 143' : ganador.color === '#e76f51' ? '231, 111, 81' : '244, 162, 97'}, 0.15); border-left: 4px solid ${ganador.color}; border-radius: 0.6rem;">
              <h4 style="margin: 0 0 0.6rem 0; color: ${ganador.color}; font-size: 1.1rem;">
                üìä ${ganador.titulo} est√° ganando
              </h4>
              <p style="margin: 0; color: var(--fg); line-height: 1.6;">
                ${ganador.descripcion}
              </p>
            </div>
            
            <div style="display: flex; flex-direction: column; gap: 0.8rem;">
              <p style="margin: 0.5rem 0; font-size: 0.9rem; color: var(--muted); text-align: center;">Desglose de votos:</p>
              
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <span>Sin intervenci√≥n:</span>
                <strong style="color: #2a9d8f;">${porcentajes.base}%</strong>
              </div>
              <div style="width: 100%; background: rgba(42, 157, 143, 0.2); border-radius: 4px; height: 6px;">
                <div style="width: ${porcentajes.base}%; background: #2a9d8f; border-radius: 4px; height: 100%;"></div>
              </div>
              
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <span>Pol√≠ticas moderadas:</span>
                <strong style="color: #e76f51;">${porcentajes.moderado}%</strong>
              </div>
              <div style="width: 100%; background: rgba(231, 111, 81, 0.2); border-radius: 4px; height: 6px;">
                <div style="width: ${porcentajes.moderado}%; background: #e76f51; border-radius: 4px; height: 100%;"></div>
              </div>
              
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <span>Pol√≠ticas agresivas:</span>
                <strong style="color: #f4a261;">${porcentajes.agresivo}%</strong>
              </div>
              <div style="width: 100%; background: rgba(244, 162, 97, 0.2); border-radius: 4px; height: 6px;">
                <div style="width: ${porcentajes.agresivo}%; background: #f4a261; border-radius: 4px; height: 100%;"></div>
              </div>
            </div>
            
            <p style="text-align: center; margin: 0.5rem 0; color: var(--muted); font-size: 0.85rem;">
              <strong>${total}</strong> voto${total !== 1 ? 's' : ''}
            </p>
          </div>
        `;
        resultsContent.innerHTML = html;
      }
    });
  </script>
  <script src="app.js"></script>
</body>
</html>
